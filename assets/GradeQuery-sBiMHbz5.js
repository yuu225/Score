import{d as te,r as m,m as s,n as S,p as ae,c as y,a as t,w as n,b as u,E as ne,q as re,s as oe,f as b,F,v as z,j as d,t as i,x as ue,y as V,z as se,o as p,_ as de}from"./index-D2HBG-fb.js";const ie={class:"grade-query"},ce={key:0,class:"statistics"},ve={class:"pagination-container"},pe=te({__name:"GradeQuery",setup(me){const r=m({studentId:"",courseId:"",minScore:null,maxScore:null,dateRange:null}),w=s(()=>S.students.value),D=s(()=>S.courses.value);m([]);const h=m(!1),v=m(1),f=m(10),C=m(),o=s(()=>S.grades.value.filter(l=>{if(r.value.studentId&&l.studentId!==r.value.studentId||r.value.courseId&&l.courseId!==r.value.courseId||r.value.minScore!==null&&l.score<r.value.minScore||r.value.maxScore!==null&&l.score>r.value.maxScore)return!1;if(r.value.dateRange&&r.value.dateRange.length===2){const e=new Date(l.createTime).toISOString().split("T")[0];if(e<r.value.dateRange[0]||e>r.value.dateRange[1])return!1}return!0})),U=s(()=>{const l=(v.value-1)*f.value,e=l+f.value;return o.value.slice(l,e)}),M=s(()=>o.value.length===0?0:(o.value.reduce((e,x)=>e+x.score,0)/o.value.length).toFixed(1)),N=s(()=>o.value.length===0?0:Math.max(...o.value.map(l=>l.score))),T=s(()=>o.value.length===0?0:Math.min(...o.value.map(l=>l.score))),q=s(()=>o.value.length===0?0:(o.value.filter(e=>e.score>=60).length/o.value.length*100).toFixed(1)),G=s(()=>o.value.length===0?0:(o.value.filter(e=>e.score>=90).length/o.value.length*100).toFixed(1)),L=s(()=>o.value.length===0?0:(o.value.filter(e=>e.score>=80&&e.score<90).length/o.value.length*100).toFixed(1)),B=s(()=>o.value.length===0?0:(o.value.filter(e=>e.score<60).length/o.value.length*100).toFixed(1)),Y=async()=>{h.value=!0;try{h.value=!1}catch{ne.error("获取成绩列表失败"),h.value=!1}},E=()=>{v.value=1},Q=()=>{C.value&&C.value.resetFields(),r.value={studentId:"",courseId:"",minScore:null,maxScore:null,dateRange:null},v.value=1},P=l=>{f.value=l,v.value=1},j=l=>{v.value=l},O=l=>l>=90?"text-success":l>=80?"text-primary":l>=60?"text-warning":"text-danger",A=l=>l>=90?"优秀":l>=80?"良好":l>=60?"及格":"不及格",H=l=>l>=90?"success":l>=80?"primary":l>=60?"warning":"danger";return ae(()=>{S.initData(),Y()}),(l,e)=>{const x=u("el-option"),I=u("el-select"),_=u("el-form-item"),R=u("el-input-number"),J=u("el-date-picker"),k=u("el-button"),K=u("el-form"),c=u("el-descriptions-item"),W=u("el-descriptions"),g=u("el-table-column"),X=u("el-tag"),Z=u("el-table"),$=u("el-pagination"),ee=u("el-card"),le=ue("loading");return p(),y("div",ie,[t(ee,null,{header:n(()=>e[7]||(e[7]=[b("div",{class:"card-header"},[b("h2",null,"成绩查询")],-1)])),default:n(()=>[t(K,{model:r.value,ref_key:"queryFormRef",ref:C,inline:"",class:"search-form"},{default:n(()=>[t(_,{label:"学生"},{default:n(()=>[t(I,{modelValue:r.value.studentId,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.studentId=a),placeholder:"请选择学生",clearable:"",filterable:""},{default:n(()=>[(p(!0),y(F,null,z(w.value,a=>(p(),V(x,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"课程"},{default:n(()=>[t(I,{modelValue:r.value.courseId,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.courseId=a),placeholder:"请选择课程",clearable:"",filterable:""},{default:n(()=>[(p(!0),y(F,null,z(D.value,a=>(p(),V(x,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"成绩范围"},{default:n(()=>[t(R,{modelValue:r.value.minScore,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.minScore=a),min:0,max:100,placeholder:"最低分"},null,8,["modelValue"]),e[8]||(e[8]=b("span",{class:"separator"},"-",-1)),t(R,{modelValue:r.value.maxScore,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.maxScore=a),min:0,max:100,placeholder:"最高分"},null,8,["modelValue"])]),_:1,__:[8]}),t(_,{label:"录入时间"},{default:n(()=>[t(J,{modelValue:r.value.dateRange,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(_,null,{default:n(()=>[t(k,{type:"primary",onClick:E},{default:n(()=>e[9]||(e[9]=[d("查询")])),_:1,__:[9]}),t(k,{onClick:Q},{default:n(()=>e[10]||(e[10]=[d("重置")])),_:1,__:[10]})]),_:1})]),_:1},8,["model"]),o.value.length>0?(p(),y("div",ce,[t(W,{column:4,border:""},{default:n(()=>[t(c,{label:"总人数"},{default:n(()=>[d(i(o.value.length),1)]),_:1}),t(c,{label:"平均分"},{default:n(()=>[d(i(M.value),1)]),_:1}),t(c,{label:"最高分"},{default:n(()=>[d(i(N.value),1)]),_:1}),t(c,{label:"最低分"},{default:n(()=>[d(i(T.value),1)]),_:1}),t(c,{label:"及格率"},{default:n(()=>[d(i(q.value)+"%",1)]),_:1}),t(c,{label:"优秀率"},{default:n(()=>[d(i(G.value)+"%",1)]),_:1}),t(c,{label:"良好率"},{default:n(()=>[d(i(L.value)+"%",1)]),_:1}),t(c,{label:"不及格率"},{default:n(()=>[d(i(B.value)+"%",1)]),_:1})]),_:1})])):re("",!0),oe((p(),V(Z,{data:U.value,style:{width:"100%"}},{default:n(()=>[t(g,{prop:"studentName",label:"学生姓名"}),t(g,{prop:"courseName",label:"课程名称"}),t(g,{prop:"score",label:"成绩",width:"100"},{default:n(({row:a})=>[b("span",{class:se(O(a.score))},i(a.score),3)]),_:1}),t(g,{prop:"level",label:"等级",width:"100"},{default:n(({row:a})=>[t(X,{type:H(a.score)},{default:n(()=>[d(i(A(a.score)),1)]),_:2},1032,["type"])]),_:1}),t(g,{prop:"createTime",label:"录入时间",width:"180"})]),_:1},8,["data"])),[[le,h.value]]),b("div",ve,[t($,{"current-page":v.value,"onUpdate:currentPage":e[5]||(e[5]=a=>v.value=a),"page-size":f.value,"onUpdate:pageSize":e[6]||(e[6]=a=>f.value=a),total:o.value.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onSizeChange:P,onCurrentChange:j},null,8,["current-page","page-size","total"])])]),_:1})])}}}),_e=de(pe,[["__scopeId","data-v-ffc566c7"]]);export{_e as default};
