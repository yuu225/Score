import{d as W,r as B,m as u,n as R,p as X,c as I,a as t,w as a,b as d,y as S,q as Z,F as Y,v as T,j as m,f as l,t as i,z as $,o as p,_ as ee}from"./index-D2HBG-fb.js";const te={class:"statistics-page"},ae={class:"card-header-small"},le={class:"statistics-detail"},se={class:"detail-item"},ne={class:"detail-item"},oe={class:"text-danger"},re={class:"card-header-small"},ue={class:"statistics-detail"},de={class:"detail-item"},ce={class:"text-success"},ie={class:"detail-item"},pe={class:"card-header-small"},ve={class:"statistics-detail"},me={class:"detail-item"},_e={class:"text-success"},fe={class:"detail-item"},ge={class:"text-primary"},he={class:"card-header-small"},be={class:"statistics-detail"},xe={class:"detail-item"},ye={key:1,class:"charts-container"},Re={class:"chart-wrapper"},Ie={class:"chart-wrapper"},Se=W({__name:"Statistics",setup(we){const r=B({studentId:"",courseId:"",dateRange:null}),w=B(),U=u(()=>R.students.value),z=u(()=>R.courses.value),s=u(()=>R.grades.value.filter(n=>{if(r.value.studentId&&n.studentId!==r.value.studentId||r.value.courseId&&n.courseId!==r.value.courseId)return!1;if(r.value.dateRange&&r.value.dateRange.length===2){const e=new Date(n.createTime).toISOString().split("T")[0];if(e<r.value.dateRange[0]||e>r.value.dateRange[1])return!1}return!0})),N=u(()=>s.value.filter(n=>n.score>=60).length),V=u(()=>s.value.length-N.value),E=u(()=>s.value.length===0?0:(s.value.reduce((e,c)=>e+c.score,0)/s.value.length).toFixed(1)),j=u(()=>s.value.length===0?0:Math.max(...s.value.map(n=>n.score))),C=u(()=>s.value.length===0?0:Math.min(...s.value.map(n=>n.score))),b=u(()=>s.value.length===0?0:Number((N.value/s.value.length*100).toFixed(1))),F=u(()=>{if(s.value.length===0)return 0;const n=s.value.filter(e=>e.score>=90).length;return Number((n/s.value.length*100).toFixed(1))}),k=u(()=>{if(s.value.length===0)return 0;const n=s.value.filter(e=>e.score>=80&&e.score<90).length;return Number((n/s.value.length*100).toFixed(1))}),A=u(()=>s.value.length===0?0:Number((V.value/s.value.length*100).toFixed(1))),G=u(()=>{const n=new Map;return s.value.forEach(e=>{n.has(e.courseId)||n.set(e.courseId,{courseName:e.courseName,totalScore:0,count:0,passCount:0});const c=n.get(e.courseId);c.totalScore+=e.score,c.count++,e.score>=60&&c.passCount++}),Array.from(n.values()).map(e=>({courseName:e.courseName,avgScore:e.totalScore/e.count,passRate:Number((e.passCount/e.count*100).toFixed(1))}))}),L=u(()=>[{range:"90-100",min:90,max:100},{range:"80-89",min:80,max:89},{range:"70-79",min:70,max:79},{range:"60-69",min:60,max:69},{range:"0-59",min:0,max:59}].map(e=>{const c=s.value.filter(h=>h.score>=e.min&&h.score<=e.max).length;return{range:e.range,count:c,percentage:Number((c/s.value.length*100).toFixed(1))}})),O=n=>{switch(n){case"90-100":return"success";case"80-89":return"primary";case"70-79":case"60-69":return"warning";default:return"exception"}},Q=()=>{},H=()=>{w.value&&w.value.resetFields(),r.value={studentId:"",courseId:"",dateRange:null}};return X(()=>{R.initData()}),(n,e)=>{const c=d("el-option"),h=d("el-select"),x=d("el-form-item"),J=d("el-date-picker"),D=d("el-button"),K=d("el-form"),y=d("el-tag"),v=d("el-card"),_=d("el-col"),f=d("el-progress"),M=d("el-row"),g=d("el-table-column"),q=d("el-table"),P=d("el-empty");return p(),I("div",te,[t(v,null,{header:a(()=>e[3]||(e[3]=[l("div",{class:"card-header"},[l("h2",null,"成绩统计分析")],-1)])),default:a(()=>[t(K,{model:r.value,ref_key:"queryFormRef",ref:w,inline:"",class:"search-form"},{default:a(()=>[t(x,{label:"学生"},{default:a(()=>[t(h,{modelValue:r.value.studentId,"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.studentId=o),placeholder:"请选择学生",clearable:"",filterable:""},{default:a(()=>[(p(!0),I(Y,null,T(U.value,o=>(p(),S(c,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"课程"},{default:a(()=>[t(h,{modelValue:r.value.courseId,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.courseId=o),placeholder:"请选择课程",clearable:"",filterable:""},{default:a(()=>[(p(!0),I(Y,null,T(z.value,o=>(p(),S(c,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"录入时间"},{default:a(()=>[t(J,{modelValue:r.value.dateRange,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.dateRange=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(x,null,{default:a(()=>[t(D,{type:"primary",onClick:Q},{default:a(()=>e[4]||(e[4]=[m("查询")])),_:1,__:[4]}),t(D,{onClick:H},{default:a(()=>e[5]||(e[5]=[m("重置")])),_:1,__:[5]})]),_:1})]),_:1},8,["model"]),s.value.length>0?(p(),S(M,{key:0,gutter:20,class:"statistics-cards"},{default:a(()=>[t(_,{span:6},{default:a(()=>[t(v,{shadow:"hover"},{header:a(()=>[l("div",ae,[e[6]||(e[6]=l("span",null,"总成绩数",-1)),t(y,null,{default:a(()=>[m(i(s.value.length),1)]),_:1})])]),default:a(()=>[l("div",le,[l("div",se,[e[7]||(e[7]=l("span",null,"及格人数：",-1)),l("span",null,i(N.value),1)]),l("div",ne,[e[8]||(e[8]=l("span",null,"不及格人数：",-1)),l("span",oe,i(V.value),1)])])]),_:1})]),_:1}),t(_,{span:6},{default:a(()=>[t(v,{shadow:"hover"},{header:a(()=>[l("div",re,[e[9]||(e[9]=l("span",null,"平均分",-1)),t(y,{type:"success"},{default:a(()=>[m(i(E.value),1)]),_:1})])]),default:a(()=>[l("div",ue,[l("div",de,[e[10]||(e[10]=l("span",null,"最高分：",-1)),l("span",ce,i(j.value),1)]),l("div",ie,[e[11]||(e[11]=l("span",null,"最低分：",-1)),l("span",{class:$(C.value<60?"text-danger":"")},i(C.value),3)])])]),_:1})]),_:1}),t(_,{span:6},{default:a(()=>[t(v,{shadow:"hover"},{header:a(()=>[l("div",pe,[e[12]||(e[12]=l("span",null,"及格率",-1)),t(y,{type:b.value>=80?"success":b.value>=60?"warning":"danger"},{default:a(()=>[m(i(b.value)+"% ",1)]),_:1},8,["type"])])]),default:a(()=>[l("div",ve,[l("div",me,[e[13]||(e[13]=l("span",null,"优秀率：",-1)),l("span",_e,i(F.value)+"%",1)]),l("div",fe,[e[14]||(e[14]=l("span",null,"良好率：",-1)),l("span",ge,i(k.value)+"%",1)])])]),_:1})]),_:1}),t(_,{span:6},{default:a(()=>[t(v,{shadow:"hover"},{header:a(()=>[l("div",he,[e[16]||(e[16]=l("span",null,"分数段分布",-1)),t(y,{type:"info"},{default:a(()=>e[15]||(e[15]=[m("分布图")])),_:1,__:[15]})])]),default:a(()=>[l("div",be,[l("div",xe,[t(f,{percentage:F.value,status:"success",format:()=>"优秀"},null,8,["percentage"]),t(f,{percentage:k.value,status:"warning",format:()=>"良好"},null,8,["percentage"]),t(f,{percentage:b.value-k.value-F.value,format:()=>"及格"},null,8,["percentage"]),t(f,{percentage:A.value,status:"exception",format:()=>"不及格"},null,8,["percentage"])])])]),_:1})]),_:1})]),_:1})):Z("",!0),s.value.length>0?(p(),I("div",ye,[t(M,{gutter:20},{default:a(()=>[t(_,{span:12},{default:a(()=>[t(v,{shadow:"hover"},{header:a(()=>e[17]||(e[17]=[l("div",{class:"card-header-small"},[l("span",null,"课程成绩分布")],-1)])),default:a(()=>[l("div",Re,[t(q,{data:G.value,style:{width:"100%"}},{default:a(()=>[t(g,{prop:"courseName",label:"课程名称"}),t(g,{prop:"avgScore",label:"平均分"},{default:a(({row:o})=>[m(i(o.avgScore.toFixed(1)),1)]),_:1}),t(g,{prop:"passRate",label:"及格率"},{default:a(({row:o})=>[t(f,{percentage:o.passRate,status:o.passRate>=80?"success":o.passRate>=60?"warning":"exception"},null,8,["percentage","status"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1}),t(_,{span:12},{default:a(()=>[t(v,{shadow:"hover"},{header:a(()=>e[18]||(e[18]=[l("div",{class:"card-header-small"},[l("span",null,"分数段分布")],-1)])),default:a(()=>[l("div",Ie,[t(q,{data:L.value,style:{width:"100%"}},{default:a(()=>[t(g,{prop:"range",label:"分数段"}),t(g,{prop:"count",label:"人数"}),t(g,{prop:"percentage",label:"占比"},{default:a(({row:o})=>[t(f,{percentage:o.percentage,status:O(o.range)},null,8,["percentage","status"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1})]),_:1})])):(p(),S(P,{key:2,description:"暂无成绩数据"}))]),_:1})])}}}),Fe=ee(Se,[["__scopeId","data-v-b356c507"]]);export{Fe as default};
